import{_ as I,d as R,u as G,q as P,r as p,k as S,e as D,c as u,s as y,w as t,M as s,j as o,o as g,f as h,l as j,m as A}from"./index.922aee54.js";import{g as J,u as L,a as W,c as H}from"./tagManagement.25f6bf47.js";const K={class:"tag-form"},O={class:"cover-upload"},Q=["src"],X={class:"upload-mask"},Y=R({__name:"TagForm",setup(Z){const f=G(),v=P(),d=p(!1),E=p(!1),F=p(!1),a=p({name:"",cover:null,intro:null,status:1}),C={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"}]},V=async l=>{try{E.value=!0;const e=await J(l);a.value=e}catch{s.error("\u83B7\u53D6\u6807\u7B7E\u8BE6\u60C5\u5931\u8D25")}finally{E.value=!1}},b=async l=>{var i,m,n,_;const e=((i=l.fileItem)==null?void 0:i.file)||l.file;if(!((m=e==null?void 0:e.type)!=null&&m.startsWith("image/"))){s.error("\u8BF7\u9009\u62E9\u56FE\u7247\u6587\u4EF6 (JPEG/PNG)");return}if(e.size>2*1024*1024){s.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC72MB");return}try{const r=await L(e);a.value.cover=r.avatar}catch(r){console.error("\u4E0A\u4F20\u9519\u8BEF:",r),s.error(`\u4E0A\u4F20\u5931\u8D25: ${((_=(n=r.response)==null?void 0:n.data)==null?void 0:_.message)||r.message||"\u670D\u52A1\u5668\u9519\u8BEF"}`)}return!1},k=()=>{s.warning("\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u5C01\u9762\u6587\u4EF6")},w=l=>{s.error(`\u4E0A\u4F20\u51FA\u9519: ${l.message||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}`)},x=l=>{const e=l.target;e.src="/default-cover.png"},T=async()=>{try{F.value=!0,d.value?(await W(f.params.id,a.value),s.success("\u66F4\u65B0\u6210\u529F")):(await H(a.value),s.success("\u521B\u5EFA\u6210\u529F")),v.push("/tags")}catch{s.error(d.value?"\u66F4\u65B0\u5931\u8D25":"\u521B\u5EFA\u5931\u8D25")}finally{F.value=!1}};return S(()=>{f.params.id&&(d.value=!0,V(f.params.id))}),(l,e)=>{const i=o("a-page-header"),m=o("a-input"),n=o("a-form-item"),_=o("icon-image"),r=o("icon-edit"),M=o("a-upload"),U=o("a-textarea"),N=o("a-switch"),B=o("a-button"),$=o("a-space"),q=o("a-form"),z=o("a-card");return g(),D("div",K,[u(i,{title:d.value?"\u7F16\u8F91\u6807\u7B7E":"\u6DFB\u52A0\u6807\u7B7E",subtitle:"\u6807\u7B7E\u4FE1\u606F",onBack:e[0]||(e[0]=c=>y(v).go(-1))},null,8,["title"]),u(z,{loading:E.value},{default:t(()=>[u(q,{model:a.value,rules:C,layout:"vertical",onSubmit:T},{default:t(()=>[u(n,{label:"\u6807\u7B7E\u540D\u79F0",field:"name"},{default:t(()=>[u(m,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=c=>a.value.name=c),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u5C01\u9762\u56FE",field:"cover"},{default:t(()=>[u(M,{"custom-request":b,"show-file-list":!1,accept:"image/*",limit:1,"max-size":2048,onExceed:k,onError:w},{"upload-button":t(()=>[h("div",O,[a.value.cover?(g(),D("img",{key:0,src:a.value.cover,alt:"cover",onError:x},null,40,Q)):(g(),j(_,{key:1})),h("div",X,[u(r)])])]),_:1})]),_:1}),u(n,{label:"\u7B80\u4ECB",field:"intro"},{default:t(()=>[u(U,{modelValue:a.value.intro,"onUpdate:modelValue":e[2]||(e[2]=c=>a.value.intro=c),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u7B80\u4ECB","auto-size":{minRows:3}},null,8,["modelValue"])]),_:1}),u(n,{label:"\u72B6\u6001",field:"status"},{default:t(()=>[u(N,{modelValue:a.value.status,"onUpdate:modelValue":e[3]||(e[3]=c=>a.value.status=c),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])]),_:1}),u(n,null,{default:t(()=>[u($,null,{default:t(()=>[u(B,{type:"primary","html-type":"submit",loading:F.value},{default:t(()=>e[5]||(e[5]=[A(" \u63D0\u4EA4 ")])),_:1,__:[5]},8,["loading"]),u(B,{onClick:e[4]||(e[4]=c=>y(v).go(-1))},{default:t(()=>e[6]||(e[6]=[A("\u53D6\u6D88")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["loading"])])}}});var ae=I(Y,[["__scopeId","data-v-2deda886"]]);export{ae as default};
